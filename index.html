// ... (same as current code above)

  <script>
    // ... (same constants and year population)

    async function findMovies() {
      const mood = document.getElementById("moodInput").value.trim().toLowerCase();
      const yearMode = yearType.value;
      const yearValue = yearSelect.value;
      const sortBy = document.getElementById("sortBy").value;
      const language = document.getElementById("language").value;
      const actor = document.getElementById("actorInput").value.trim();
      const genreCheckboxes = document.querySelectorAll('.genre:checked');

      const resultsDiv = document.getElementById("results");
      resultsDiv.innerHTML = "Loading...";

      let personId = null;
      if (actor) {
        const personRes = await fetch(TMDB_SEARCH_PERSON + encodeURIComponent(actor));
        const personData = await personRes.json();
        if (personData.results && personData.results[0]) {
          personId = personData.results[0].id;
        }
      }

      let query = `${API_BASE}?mood=${mood}&sort_by=${sortBy}`;
      if (language) query += `&language=${language}`;
      if (personId) query += `&with_cast=${personId}`;

      if (yearMode === "single") {
        query += `&primary_release_year=${yearValue}`;
      } else {
        const [start, end] = yearValue.split("-");
        query += `&primary_release_date.gte=${start}-01-01&primary_release_date.lte=${end}-12-31`;
      }

      const selectedGenres = Array.from(genreCheckboxes).map(cb => cb.value);
      if (selectedGenres.length > 0) {
        query += `&with_genres=${selectedGenres.join(',')}`;
      }

      try {
        const res = await fetch(query + `&_=${new Date().getTime()}`); // prevent caching
        const movies = await res.json();

        if (!movies.length) {
          resultsDiv.innerHTML = "<p>No movies found.</p>";
          return;
        }

        resultsDiv.innerHTML = `<h2>Results</h2>`;

        for (const movie of movies) {
          const searchTerm = encodeURIComponent(`${movie.title} official trailer`);
          const videoUrl = `https://www.youtube.com/embed?listType=search&list=${searchTerm}`;

          const movieHtml = `
            <div class="movie">
              <img src="https://image.tmdb.org/t/p/w200${movie.poster_path}" alt="${movie.title}" onclick="showTrailer('${videoUrl}')" />
              <p>${movie.title}</p>
            </div>`;

          resultsDiv.innerHTML += movieHtml;
        }
      } catch (err) {
        console.error(err);
        resultsDiv.innerHTML = "<p>Error fetching movies. Try again later.</p>";
      }
    }

    document.addEventListener("DOMContentLoaded", () => {
      document.getElementById("moodInput").addEventListener("keypress", e => {
        if (e.key === "Enter") {
          findMovies();
        }
      });
    });

    function showTrailer(url) {
      const modal = document.getElementById("trailerModal");
      const frame = document.getElementById("trailerFrame");
      frame.src = url;
      modal.style.display = "flex";
    }

    function closeTrailer() {
      const modal = document.getElementById("trailerModal");
      const frame = document.getElementById("trailerFrame");
      frame.src = "";
      modal.style.display = "none";
    }
  </script>
</body>
</html>
